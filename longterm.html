<script>
  document.getElementById("ltcForm").addEventListener("submit", function (e) {
    e.preventDefault();

    const years = parseFloat(document.getElementById("coveredYears").value);
    const monthly = parseFloat(document.getElementById("expensePerMonth").value);
    const total = years * monthly * 12;

    const resultText = `📊 長照預估費用試算結果：<br>
🧓 ${years} 年 × 每月 ${monthly.toLocaleString()} 元 × 12 個月<br>
➡️ 預估總支出：約 <strong>${total.toLocaleString()}</strong> 元`;

    document.getElementById("result").innerHTML = resultText;

    const payload = {
      type: "longterm",
      name: document.querySelector("input[name='name']").value,
      phone: document.querySelector("input[name='phone']").value,
      coveredYears: years,
      expensePerMonth: monthly,
      estimateCost: total
    };

    fetch("https://script.google.com/macros/s/AKfycbxXzyOUR_COMMON_EXEC_URL/exec", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(payload)
    })
    .then(res => res.json())
    .then(res => {
      if (res.result === "success") {
        document.getElementById("result").innerHTML += "<br><br>✅ 試算完成，建議盡早準備長照保障！";
      } else {
        document.getElementById("result").innerHTML += "<br><br>⚠️ 系統錯誤：" + res.message;
      }
    })
    .catch(err => {
      document.getElementById("result").innerHTML += "<br><br>❌ 發生錯誤，請稍後再試。";
    });

    e.target.reset();
  });
</script>
